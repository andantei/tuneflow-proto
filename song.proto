syntax = "proto2";

package song;

message Note {
  optional int32 pitch = 1;
  optional int32 velocity = 2;
  optional int64 start_tick = 3;
  optional float start_time = 4;
  optional int64 end_tick = 5;
  optional float end_time = 6;
}

message TempoEvent {
  optional int64 ticks = 1;
	optional float bpm = 2;
	optional float time = 3;
}

message TimeSignatureEvent {
  optional int64 ticks = 1;
	optional int32 numerator = 2;
	optional int32 denominator = 3;
}

message InstrumentInfo {
  optional int32 program = 1;
  optional bool is_drum = 2;
}

message AudioPluginInfo {
  optional string tf_id = 1;
  optional bool is_enabled = 2;
}

message Track {
  optional InstrumentInfo instrument = 1;
  repeated Note notes = 2; // Deprecated, use clips instead.
  repeated InstrumentInfo suggested_instruments = 3;
  optional string uuid = 4; // Assigned by client.
  optional float volume = 5;
  optional bool solo = 6;
  optional bool muted = 7;
  optional int32 rank = 8; // Assigned by client.
  optional int64 track_start_tick = 9; // Assigned by client.
  optional int64 track_end_tick = 10; // Assigned by client.
  optional AudioPluginInfo sampler_plugin = 11;
  repeated AudioPluginInfo audio_plugin = 12;
  repeated Clip clips = 13;
}

message Clip {
  // Avoid using "id" as the name as it will conflict with many internal implementations of other libraries.
  optional string uid = 1;
  optional int64 clip_start_tick = 2;
  optional int64 clip_end_tick = 3;
  // Notes will use absolute ticks.
  // This will be all the notes in the clip, including
  // those that may not be in the clip's range.
  repeated Note notes = 4;
}

message Song {
  optional int32 PPQ = 1;
  repeated TempoEvent tempos = 2;
  repeated TimeSignatureEvent time_signatures = 3;
  optional int64 last_tick = 4;
  optional float duration = 5;
  repeated Track tracks = 6;
}